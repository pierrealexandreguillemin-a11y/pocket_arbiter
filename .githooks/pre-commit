#!/bin/sh
# Cross-platform pre-commit hook wrapper
# ISO 12207: BLOCKING - Must use Python with pytest installed

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"

# Find Python with pytest (MANDATORY for ISO 29119 compliance)
find_python_with_pytest() {
    for py in "/c/Python313/python.exe" "python3" "python" "/usr/bin/python3"; do
        if command -v "$py" >/dev/null 2>&1; then
            if "$py" -c "import pytest" >/dev/null 2>&1; then
                echo "$py"
                return 0
            fi
        fi
    done
    return 1
}

PYTHON=$(find_python_with_pytest)
if [ -z "$PYTHON" ]; then
    echo "=============================================="
    echo "  ISO 29119 VIOLATION: pytest NOT INSTALLED"
    echo "=============================================="
    echo "Install with: pip install pytest pytest-cov"
    echo "COMMIT BLOCKED"
    exit 1
fi

# Run Python hook
exec "$PYTHON" "$SCRIPT_DIR/pre-commit.py"
